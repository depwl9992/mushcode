<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Thursday, August 29, 2013, 7:46 AM -->
<!-- MuClient version 4.90 -->

<!-- Plugin "Void_Vote" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Void_Vote"
   author="Samakhulis Moonflair"
   id="17788dcde33a62887d542191"
   language="Lua"
   purpose="A persistent vote button plus hyperlink every 12 hours for TMS"
   save_state="y"
   date_written="2013-08-29 07:44:22"
   requires="4.00"
   version="1.0"
   >
<description trim="y">
<![CDATA[
A quick vote button and hyperlink that is displayed every 12 hours for voting for the Void MUSH on TMS.

To force the script, type VOTE.

Revisions:
2023-10-01 - Added 3 hour timer with PHAN prompts.
2023-11-20 - Vote button now stores the current timestamp when clicked, and will not allow the button to
             reappear until 24 hours have elapsed. This is saved in the state file, so reconnections and
             restarts also are respected.
]]>
</description>

</plugin>


<!--  Aliases  -->

<aliases>
  <alias
   match="vote"
   enabled="y"
   group="scripts"
   send_to="12"
   sequence="100"
  >
  <send><![CDATA[
time = tonumber(os.time())
if GetVariable("lastVoted") ~= nil and GetVariable("lastVoted") ~= "" then
  nextAllowed = tonumber(GetVariable("lastVoted"))+86400
else
    nextAllowed = 86400
end -- if

if time >= nextAllowed then
  btn_width = 40
  btn_height = 25

  Hyperlink ("!!17788dcde33a62887d542191:vote_page(0, vote)", "Vote for the Void", "Vote for the Void on TMC", "white", "black", 0)
  Note()
  WindowCreate("vote",0,0,btn_width,btn_height,4,0,ColourNameToRGB("black"))

  WindowFont("vote","default","Trebuchet MS",12,true,false,false,false,0,0)
  WindowText("vote","default","Vote",3,0,btn_width,btn_height,ColourNameToRGB("white"),false)

  WindowRectOp("vote",1,
               0,0,btn_width,btn_height,
               ColourNameToRGB("white"))

  WindowAddHotspot("vote","btn",
                   0,0,btn_width,btn_height,
                   "",
                   "",
                   "",
                   "",
                   "vote_page",
                   "Vote on MUDVerse",
                   1,0)

  WindowShow("vote",true)
end -- if

  ]]></send>
  </alias>
</aliases>

<!--  Timers  -->

<timers>
  <timer enabled="y" hour="12" second="0.00" offset_second="0.00"    send_to="12"
active_closed="y" >
  <send>Execute("vote")</send>

  </timer>

  <timer enabled="y" hour="3" second="0.00" offset_second="0.00"     send_to="12"
active_closed="y" >
    <send>Note("Pick one of the following and send it along!\n'phan TMS might be dead, but we're not!! https://www.mudverse.com/vote/551'\n'phan Only YOU can help Smokey prevent stagnancy! https://www.mudverse.com/vote/551'\n'phan Yer doin' it right if we rank above 10! https://www.mudverse.com/vote/551.'\n'phan A vote for the Void is a vote for a long life! https://www.mudverse.com/vote/551'")</send>
  </timer>
</timers>

<!--  Script  -->


<script>
<![CDATA[
TMC_Link="https://www.mudconnect.com/cgi-bin/search.cgi?mode=mud_listing&mud=The+Fairy+Garden+MUSH"
Verse_Link="http://www.mudverse.com/vote/551"
function vote_page (flags, hotspot_id)
        OpenBrowser(TMC_Link)
        OpenBrowser(Verse_Link)
        WindowShow("vote",false)
        WindowDelete("vote")
    SetVariable("lastVoted",os.time())
    SaveState()
end -- function

function OnPluginConnect()
  Execute("vote")
end -- function


]]>
</script>


<!--  Plugin help  -->

<aliases>
  <alias
   script="OnHelp"
   match="VoidVote:help"
   enabled="y"
  >
  </alias>
</aliases>

<script>
<![CDATA[
function OnHelp ()
  world.Note (world.GetPluginInfo (world.GetPluginID (), 3))
end
]]>
</script>

</muclient>
